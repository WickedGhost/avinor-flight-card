try{window.customCards=window.customCards||[];window.customCards.some(t=>"avinor-flight-card"===t.type)||window.customCards.push({type:"avinor-flight-card",name:"Avinor Flight Card",description:"Table of Avinor flights from sensor attributes (custom component).",preview:!0,documentationURL:"https://github.com/WickedGhost/avinor_flight_data",version:"1.0.6"})}catch(t){}class t extends HTMLElement{constructor(){super(),this._config=null,this._hass=null,this._excludedColumns=new Set,this._card=null,this._content=null}static getStubConfig(t){if(t&&t.states){const e=Object.keys(t.states).find(t=>t.startsWith("sensor.avinor_"));if(e)return{entity:e,title:"Avinor Flight Data"}}return{entity:"",title:"Avinor Flight Data",exclude_columns:[],compact:!1,show_table_header:!0,show_meta:!0,row_click_action:"none",sort_by:"scheduled",sort_dir:"asc",max_rows:0}}static getConfigElement(){return document.createElement("avinor-flight-card-editor")}setConfig(t){if(!t||!t.entity)throw new Error("Please define entity");this._config={title:"Avinor Flight Data",exclude_columns:[],compact:!1,show_table_header:!0,show_meta:!0,row_click_action:"none",sort_by:"scheduled",sort_dir:"asc",max_rows:0,...t},this._excludedColumns=this._normalizeExcludedColumns(this._config.exclude_columns),this._card||(this._card=document.createElement("ha-card"),this._content=document.createElement("div"),this._content.style.padding="16px",this._card.appendChild(this._content),this.appendChild(this._card)),this._card.header=this._config.title||"Avinor Flight Data",this._hass&&(this.hass=this._hass)}set hass(t){if(this._hass=t,!this._config||!this._content)return;this._excludedColumns=this._normalizeExcludedColumns(this._config.exclude_columns);const e=this._config.entity,n=t&&t.states?t.states[e]:void 0;if(!n)return void(this._content.innerHTML=`<div>Entity ${e} not found</div>`);const i=n.attributes||{},o=Array.isArray(i.flights)?i.flights:[],r=i.airport||"",a=i.direction||"",s=i.last_update||"",c="A"===a,l=t=>!!this._excludedColumns.has(t)||!(!c||"check_in"!==t&&"gate"!==t),d=this._formatUpdated(s),h=this._applySortAndLimit(o),g=`Airport: ${r} • Direction: ${a} • Flights: ${h.length===o.length?`${o.length}`:`${h.length}/${o.length}`} • Updated: ${d}`,p="more-info"===this._config.row_click_action,u=h.map(t=>{const n={S:"Schengen",D:"Domestic",I:"International"}[t.dom_int]||t.dom_int||"",i=this._getAirportName(t.airport),o=this._getStatusText(t.status_code),r=this._getStatusKind(t.status_code),a=this._formatScheduleCell(t);return`\n        <tr class="afc-row ${p?"afc-row--clickable":""}" ${p?`tabindex="0" role="button" data-entity="${this._e(e)}"`:""}>\n          ${l("flight")?"":`<td>${this._e(t.flightId)}</td>`}\n          ${l("type")?"":`<td>${this._e(n)}</td>`}\n          ${l("scheduled")?"":`<td>${a}</td>`}\n          ${l("airport")?"":`<td>${this._e(i)}</td>`}\n          ${l("check_in")?"":`<td>${this._e(t.check_in)}</td>`}\n          ${l("gate")?"":`<td>${this._e(t.gate)}</td>`}\n          ${l("status")?"":`<td><span class="afc-status afc-status--${r}">${this._e(o)}</span></td>`}\n        </tr>\n      `}).join(""),f=this._config.show_table_header?`\n          <thead>\n            <tr>\n              ${l("flight")?"":"<th>Flight</th>"}\n              ${l("type")?"":"<th>Type</th>"}\n              ${l("scheduled")?"":"<th>Scheduled</th>"}\n              ${l("airport")?"":"<th>Airport</th>"}\n              ${l("check_in")?"":"<th>Check-in</th>"}\n              ${l("gate")?"":"<th>Gate</th>"}\n              ${l("status")?"":"<th>Status</th>"}\n            </tr>\n          </thead>\n        `:"",_=this._config.show_meta?`<div class="afc-meta">${this._e(g)}</div>`:"",m=`\n      .afc-meta { margin-bottom: 8px; font-size: 0.9em; color: var(--secondary-text-color); }\n      .afc-table-wrap { overflow: auto; }\n      .afc-table { width: 100%; border-collapse: collapse; }\n      .afc-table th { text-align: left; font-weight: 500; color: var(--primary-text-color); border-bottom: 1px solid var(--divider-color); padding: ${this._config.compact?"6px":"8px"}; }\n      .afc-table td { border-bottom: 1px solid var(--divider-color); padding: ${this._config.compact?"6px":"8px"}; }\n      .afc-table tbody tr:last-child td { border-bottom: none; }\n\n      .afc-row--clickable { cursor: pointer; }\n      .afc-row--clickable:hover { background: var(--table-row-background-hover-color, rgba(128, 128, 128, 0.1)); }\n      .afc-row--clickable:focus { outline: 2px solid var(--primary-color); outline-offset: -2px; }\n\n      .afc-time { display: inline-flex; gap: 6px; align-items: baseline; white-space: nowrap; }\n      .afc-time__orig { color: var(--primary-text-color); }\n      .afc-time__new { color: var(--warning-color, var(--primary-color)); font-weight: 600; }\n      .afc-time__arrow { color: var(--secondary-text-color); }\n\n      .afc-status { display: inline-block; font-weight: 600; }\n      .afc-status--ok { color: var(--primary-text-color); }\n      .afc-status--info { color: var(--secondary-text-color); }\n      .afc-status--warn { color: var(--warning-color, var(--primary-color)); }\n      .afc-status--bad { color: var(--error-color); }\n      .afc-status--good { color: var(--success-color); }\n\n      .afc-footer { margin-top: 8px; font-size: 0.8em; color: var(--secondary-text-color); }\n    `;if(this._content.innerHTML=`\n      <style>${m}</style>\n      ${_}\n      <div class="afc-table-wrap">\n        <table class="afc-table">\n          ${f}\n          <tbody>\n            ${u}\n          </tbody>\n        </table>\n      </div>\n      <div class="afc-footer">\n        Flydata fra <a href="https://www.avinor.no/" target="_blank" rel="noreferrer">Avinor</a>\n      </div>\n    `,p){const t=this._content.querySelector("tbody");t&&(t.onclick=t=>{(t.target&&t.target.closest?t.target.closest(".afc-row--clickable"):null)&&this._fireMoreInfo(e)},t.onkeydown=t=>{const n=t.key;if("Enter"!==n&&" "!==n)return;(t.target&&t.target.closest?t.target.closest(".afc-row--clickable"):null)&&(t.preventDefault(),this._fireMoreInfo(e))})}}_e(t){if(null==t)return"";return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}_applySortAndLimit(t){const e=Array.isArray(t)?t.slice():[],n=String(this._config&&this._config.sort_by?this._config.sort_by:"scheduled").trim().toLowerCase(),i="desc"===String(this._config&&this._config.sort_dir?this._config.sort_dir:"asc").trim().toLowerCase()?-1:1,o=t=>{if(!t)return"";switch(n){case"flight":return t.flightId||"";case"type":return t.dom_int||"";case"airport":return this._getAirportName(t.airport||"");case"check_in":return t.check_in||"";case"gate":return t.gate||"";case"status":return t.status_code||"";default:{const e=t.new_time||t.estimated_time||t.expected_time||t.actual_time||t.time||t.schedule_time,n=this._tryParseDate(e);return n?n.getTime():this._extractTime(e)||""}}},r=e.map((t,e)=>({f:t,idx:e}));r.sort((t,e)=>{const n=o(t.f),r=o(e.f);if("number"==typeof n&&"number"==typeof r&&isFinite(n)&&isFinite(r))return n<r?-1*i:n>r?1*i:t.idx-e.idx;const a=String(n).toLowerCase(),s=String(r).toLowerCase();return a<s?-1*i:a>s?1*i:t.idx-e.idx});let a=r.map(t=>t.f);const s=this._config&&void 0!==this._config.max_rows?this._config.max_rows:0,c=Number.isFinite(Number(s))?Math.max(0,Math.floor(Number(s))):0;return c>0&&(a=a.slice(0,c)),a}_normalizeExcludedColumns(t){const e=new Set,n=Array.isArray(t)?t:"string"==typeof t?t.split(","):[];for(const t of n){if(null==t)continue;const n=String(t).trim().toLowerCase().replace(/\s+/g,"_").replace(/-/g,"_");n&&e.add(n)}return e}_getAirportName(t){if(!t)return"";return{OSL:"Oslo",BGO:"Bergen",TRD:"Trondheim",SVG:"Stavanger",BOO:"Bodø",TOS:"Tromsø",AES:"Ålesund",KRS:"Kristiansand",HAU:"Haugesund",MOL:"Molde",EVE:"Harstad/Narvik",KKN:"Kirkenes",LKL:"Lakselv",ALF:"Alta",HFT:"Hammerfest",VDS:"Vadsø",BDU:"Bardufoss",SSJ:"Sandnessjøen",MJF:"Mosjøen",RVK:"Rørvik",BNN:"Brønnøysund",SKN:"Stokmarknes",LYR:"Longyearbyen",ANX:"Andøya",FDE:"Førde",SOG:"Sogndal",FRO:"Florø",NTB:"Notodden",SKE:"Skien",TRF:"Sandefjord",RRS:"Røros",OLA:"Ørland",HOV:"Ørsta-Volda",SDN:"Sandane",CPH:"Copenhagen",ARN:"Stockholm",HEL:"Helsinki",LHR:"London",AMS:"Amsterdam",CDG:"Paris",FRA:"Frankfurt",MUC:"Munich",ZRH:"Zurich",BCN:"Barcelona",MAD:"Madrid",FCO:"Rome",IST:"Istanbul",DXB:"Dubai",DOH:"Doha",JFK:"New York",EWR:"Newark",ORD:"Chicago",LAX:"Los Angeles",MIA:"Miami",BKK:"Bangkok",SIN:"Singapore",HKG:"Hong Kong",NRT:"Tokyo",ICN:"Seoul",KEF:"Reykjavik",ATH:"Athens",DUB:"Dublin",BRU:"Brussels",VIE:"Vienna",PRG:"Prague",WAW:"Warsaw",LIS:"Lisbon",MAN:"Manchester",EDI:"Edinburgh",GLA:"Glasgow",NCE:"Nice",LYS:"Lyon",TXL:"Berlin",HAM:"Hamburg",DUS:"Düsseldorf",BER:"Berlin",CGN:"Cologne",STR:"Stuttgart"}[t]||t}_getStatusText(t){if(!t)return"";return{E:"New Info",A:"Arrived",C:"Cancelled",D:"Departed",N:"New Time",BRD:"Boarding",GCL:"Gate Closed",GTD:"Gate Open",DLY:"Delayed",EXP:"Expected",FIR:"Final Call",WIL:"Wait in Lounge",DEP:"Departed",ARR:"Arrived",CNX:"Cancelled",AIR:"Airborne",LND:"Landed",CKI:"Check-in",CKC:"Check-in Closed"}[t]||t}_extractTime(t){if(!t)return"";try{const e=new Date(t+(t.includes("Z")?"":"Z"));if(isNaN(e.getTime()))return t;const n=e.getHours().toString().padStart(2,"0");return`${n}:${e.getMinutes().toString().padStart(2,"0")}`}catch(e){return t}}_formatUpdated(t){if(!t)return"";const e=this._tryParseDate(t);if(!e)return String(t);const n=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"}).format(e),i=this._formatRelativeTime(e);return i?`${n} (${i})`:n}_tryParseDate(t){if(!t)return null;if(t instanceof Date)return isNaN(t.getTime())?null:t;const e=String(t).trim();if(!e)return null;const n=new Date(e);if(!isNaN(n.getTime()))return n;const i=new Date(e+(e.includes("Z")?"":"Z"));return isNaN(i.getTime())?null:i}_formatRelativeTime(t){const e=Date.now()-t.getTime();if(!isFinite(e))return"";const n=Math.round(e/1e3);if(n<0)return"";if(n<60)return`${n}s ago`;const i=Math.round(n/60);if(i<60)return`${i}m ago`;const o=Math.round(i/60);if(o<24)return`${o}h ago`;return`${Math.round(o/24)}d ago`}_formatScheduleCell(t){const e=this._extractTime(t.schedule_time),n=t.new_time||t.estimated_time||t.expected_time||t.actual_time||t.time,i=n?this._extractTime(n):"";return i&&i!==e?`<span class="afc-time"><span class="afc-time__orig">${this._e(e)}</span><span class="afc-time__arrow">→</span><span class="afc-time__new">${this._e(i)}</span></span>`:`<span class="afc-time"><span class="afc-time__orig">${this._e(e)}</span></span>`}_getStatusKind(t){const e=String(t||"").toUpperCase();return e?"C"===e||"CNX"===e?"bad":"DLY"===e||"N"===e||"E"===e?"warn":"A"===e||"ARR"===e||"LND"===e||"D"===e||"DEP"===e?"good":"BRD"===e||"GTD"===e||"FIR"===e?"warn":"ok":"info"}_fireMoreInfo(t){const e=new CustomEvent("hass-more-info",{bubbles:!0,composed:!0,detail:{entityId:t}});this.dispatchEvent(e)}getCardSize(){return 4}}customElements.define("avinor-flight-card",t);class e extends HTMLElement{constructor(){super(),this._config=null,this._hass=null}setConfig(t){this._config={title:"",exclude_columns:[],compact:!1,show_table_header:!0,show_meta:!0,row_click_action:"none",sort_by:"scheduled",sort_dir:"asc",max_rows:0,...t},this.render()}configChanged(t){const e=new Event("config-changed",{bubbles:!0,composed:!0});e.detail={config:t},this.dispatchEvent(e)}render(){if(!this._config)return;const t=(this._hass?Object.keys(this._hass.states).filter(t=>t.startsWith("sensor.avinor_")).sort():[]).map(t=>{const e=this._hass.states[t];return`<option value="${t}">${t} - ${e.attributes.airport||""} ${"D"===(e.attributes.direction||"")?"Departures":"Arrivals"}</option>`}).join(""),e=new Set(Array.isArray(this._config.exclude_columns)?this._config.exclude_columns.map(t=>String(t).toLowerCase().replace(/\s+/g,"_").replace(/-/g,"_")):[]),n=[{key:"flight",label:"Flight"},{key:"type",label:"Type"},{key:"scheduled",label:"Scheduled"},{key:"airport",label:"Airport"},{key:"check_in",label:"Check-in"},{key:"gate",label:"Gate"},{key:"status",label:"Status"}].map(({key:t,label:n})=>`\n      <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n        <input type="checkbox" data-col="${t}" ${e.has(t)?"checked":""} />\n        <span>${n}</span>\n      </label>\n    `).join(""),i=this._config.row_click_action||"none",o=this._config.sort_by||"scheduled",r=this._config.sort_dir||"asc",a=void 0===this._config.max_rows||null===this._config.max_rows?0:this._config.max_rows;this.innerHTML=`\n      <div style="padding: 16px;">\n        <div style="margin-bottom: 16px; position: relative;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Entity (required)\n          </label>\n          <select\n            id="entity"\n            style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n          >\n            <option value="">-- Select an entity --</option>\n            ${t}\n          </select>\n          <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">\n            Select an Avinor flight sensor entity\n          </div>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Title (optional)\n          </label>\n          <input\n            type="text"\n            id="title"\n            value="${this._config.title||""}"\n            placeholder="Avganger OSL"\n            style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n          />\n          <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">\n            Card title (leave empty for default)\n          </div>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Exclude columns (optional)\n          </label>\n          <div style="padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px;">\n            ${n}\n          </div>\n          <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">\n            Check the columns you want to hide\n          </div>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Layout (optional)\n          </label>\n          <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n            <input type="checkbox" id="compact" ${this._config.compact?"checked":""} />\n            <span>Compact rows</span>\n          </label>\n          <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n            <input type="checkbox" id="show_table_header" ${this._config.show_table_header?"checked":""} />\n            <span>Show table header</span>\n          </label>\n          <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n            <input type="checkbox" id="show_meta" ${this._config.show_meta?"checked":""} />\n            <span>Show meta line (airport/direction/updated)</span>\n          </label>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Row click action (optional)\n          </label>\n          <select\n            id="row_click_action"\n            style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n          >\n            <option value="none" ${"none"===i?"selected":""}>None</option>\n            <option value="more-info" ${"more-info"===i?"selected":""}>Open entity more-info</option>\n          </select>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Sorting & limiting (optional)\n          </label>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">\n            <div>\n              <div style="margin-bottom: 6px; color: var(--secondary-text-color);">Sort by</div>\n              <select\n                id="sort_by"\n                style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n              >\n                <option value="scheduled" ${"scheduled"===o?"selected":""}>Scheduled</option>\n                <option value="flight" ${"flight"===o?"selected":""}>Flight</option>\n                <option value="type" ${"type"===o?"selected":""}>Type</option>\n                <option value="airport" ${"airport"===o?"selected":""}>Airport</option>\n                <option value="check_in" ${"check_in"===o?"selected":""}>Check-in</option>\n                <option value="gate" ${"gate"===o?"selected":""}>Gate</option>\n                <option value="status" ${"status"===o?"selected":""}>Status</option>\n              </select>\n            </div>\n            <div>\n              <div style="margin-bottom: 6px; color: var(--secondary-text-color);">Direction</div>\n              <select\n                id="sort_dir"\n                style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n              >\n                <option value="asc" ${"asc"===r?"selected":""}>Ascending</option>\n                <option value="desc" ${"desc"===r?"selected":""}>Descending</option>\n              </select>\n            </div>\n          </div>\n          <div style="margin-top: 12px;">\n            <div style="margin-bottom: 6px; color: var(--secondary-text-color);">Max rows</div>\n            <input\n              type="number"\n              id="max_rows"\n              min="0"\n              step="1"\n              value="${a}"\n              placeholder="0"\n              style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n            />\n            <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">0 = show all flights</div>\n          </div>\n        </div>\n      </div>\n    `;const s=this.querySelector("#entity");this._config.entity&&(s.value=this._config.entity),s.addEventListener("change",t=>{this._config={...this._config,entity:t.target.value},this.configChanged(this._config)}),this.querySelector("#title").addEventListener("input",t=>{this._config={...this._config,title:t.target.value},this.configChanged(this._config)}),this.querySelectorAll('input[type="checkbox"][data-col]').forEach(t=>{t.addEventListener("change",()=>{const t=[];this.querySelectorAll('input[type="checkbox"][data-col]').forEach(e=>{e.checked&&t.push(e.getAttribute("data-col"))}),this._config={...this._config,exclude_columns:t},this.configChanged(this._config)})});const c=this.querySelector("#compact");c&&c.addEventListener("change",t=>{this._config={...this._config,compact:!!t.target.checked},this.configChanged(this._config)});const l=this.querySelector("#show_table_header");l&&l.addEventListener("change",t=>{this._config={...this._config,show_table_header:!!t.target.checked},this.configChanged(this._config)});const d=this.querySelector("#show_meta");d&&d.addEventListener("change",t=>{this._config={...this._config,show_meta:!!t.target.checked},this.configChanged(this._config)});const h=this.querySelector("#row_click_action");h&&h.addEventListener("change",t=>{this._config={...this._config,row_click_action:t.target.value},this.configChanged(this._config)});const g=this.querySelector("#sort_by");g&&g.addEventListener("change",t=>{this._config={...this._config,sort_by:t.target.value},this.configChanged(this._config)});const p=this.querySelector("#sort_dir");p&&p.addEventListener("change",t=>{this._config={...this._config,sort_dir:t.target.value},this.configChanged(this._config)});const u=this.querySelector("#max_rows");u&&u.addEventListener("input",t=>{const e=t.target.value,n=""===e?0:Number(e);this._config={...this._config,max_rows:Number.isFinite(n)?Math.max(0,Math.floor(n)):0},this.configChanged(this._config)})}set hass(t){this._hass=t,this._config&&this.render()}}customElements.define("avinor-flight-card-editor",e),console.info("%c AVINOR-FLIGHT-CARD %c Registered successfully with visual editor ","background-color: #41bdf5; color: #fff; font-weight: bold;","background-color: #333; color: #fff;");
