try{window.customCards=window.customCards||[];window.customCards.some(t=>"avinor-flight-card"===t.type)||window.customCards.push({type:"avinor-flight-card",name:"Avinor Flight Card",description:"Table of Avinor flights from sensor attributes (custom component).",preview:!0,documentationURL:"https://github.com/WickedGhost/avinor_flight_data",version:"1.0.9"})}catch(t){}class t extends HTMLElement{constructor(){super(),this._config=null,this._hass=null,this._excludedColumns=new Set,this._card=null,this._content=null,this._detailsFlightIata=null,this._detailsLoading=!1,this._detailsError="",this._detailsData=null}static getStubConfig(t){if(t&&t.states){const e=Object.keys(t.states).find(t=>t.startsWith("sensor.avinor_"));if(e)return{entity:e,title:"Avinor Flight Data"}}return{entity:"",title:"Avinor Flight Data",exclude_columns:[],compact:!1,show_table_header:!0,show_meta:!0,row_click_action:"none",sort_by:"scheduled",sort_dir:"asc",max_rows:0}}static getConfigElement(){return document.createElement("avinor-flight-card-editor")}setConfig(t){if(!t||!t.entity)throw new Error("Please define entity");this._config={title:"Avinor Flight Data",exclude_columns:[],compact:!1,show_table_header:!0,show_meta:!0,row_click_action:"none",sort_by:"scheduled",sort_dir:"asc",max_rows:0,...t},this._excludedColumns=this._normalizeExcludedColumns(this._config.exclude_columns),this._card||(this._card=document.createElement("ha-card"),this._content=document.createElement("div"),this._content.style.padding="16px",this._card.appendChild(this._content),this.appendChild(this._card)),this._card.header=this._config.title||"Avinor Flight Data",this._hass&&(this.hass=this._hass)}set hass(t){if(this._hass=t,!this._config||!this._content)return;this._excludedColumns=this._normalizeExcludedColumns(this._config.exclude_columns);const e=this._config.entity,i=t&&t.states?t.states[e]:void 0;if(!i)return void(this._content.innerHTML=`<div>Entity ${e} not found</div>`);const a=i.attributes||{},r=Array.isArray(a.flights)?a.flights:[],n=a.airport||"",o=a.direction||"",s=a.last_update||"",l="A"===o,c=t=>!!this._excludedColumns.has(t)||!(!l||"check_in"!==t&&"gate"!==t),d=this._formatUpdated(s),h=this._applySortAndLimit(r),_=`Airport: ${n} • Direction: ${o} • Flights: ${h.length===r.length?`${r.length}`:`${h.length}/${r.length}`} • Updated: ${d}`,g=this._config.row_click_action,u="more-info"===g||"flight-details"===g,p=h.map(t=>{const i={S:"Schengen",D:"Domestic",I:"International"}[t.dom_int]||t.dom_int||"",a=this._getAirportName(t.airport),r=this._getStatusText(t.status_code),n=this._getStatusKind(t.status_code),o=this._formatScheduleCell(t),s=t.flightId||"";return`\n        <tr class="afc-row ${u?"afc-row--clickable":""}" ${u?`tabindex="0" role="button" data-entity="${this._e(e)}" data-flight-iata="${this._e(s)}"`:""}>\n          ${c("flight")?"":`<td>${this._e(t.flightId)}</td>`}\n          ${c("type")?"":`<td>${this._e(i)}</td>`}\n          ${c("scheduled")?"":`<td>${o}</td>`}\n          ${c("airport")?"":`<td>${this._e(a)}</td>`}\n          ${c("check_in")?"":`<td>${this._e(t.check_in)}</td>`}\n          ${c("gate")?"":`<td>${this._e(t.gate)}</td>`}\n          ${c("status")?"":`<td><span class="afc-status afc-status--${n}">${this._e(r)}</span></td>`}\n        </tr>\n      `}).join(""),f=this._config.show_table_header?`\n          <thead>\n            <tr>\n              ${c("flight")?"":"<th>Flight</th>"}\n              ${c("type")?"":"<th>Type</th>"}\n              ${c("scheduled")?"":"<th>Scheduled</th>"}\n              ${c("airport")?"":"<th>Airport</th>"}\n              ${c("check_in")?"":"<th>Check-in</th>"}\n              ${c("gate")?"":"<th>Gate</th>"}\n              ${c("status")?"":"<th>Status</th>"}\n            </tr>\n          </thead>\n        `:"",m=this._config.show_meta?`<div class="afc-meta">${this._e(_)}</div>`:"",y=`\n      .afc-meta { margin-bottom: 8px; font-size: 0.9em; color: var(--secondary-text-color); }\n      .afc-table-wrap { overflow: auto; }\n      .afc-table { width: 100%; border-collapse: collapse; }\n      .afc-table th { text-align: left; font-weight: 500; color: var(--primary-text-color); border-bottom: 1px solid var(--divider-color); padding: ${this._config.compact?"6px":"8px"}; }\n      .afc-table td { border-bottom: 1px solid var(--divider-color); padding: ${this._config.compact?"6px":"8px"}; }\n      .afc-table tbody tr:last-child td { border-bottom: none; }\n\n      .afc-row--clickable { cursor: pointer; }\n      .afc-row--clickable:hover { background: var(--table-row-background-hover-color, rgba(128, 128, 128, 0.1)); }\n      .afc-row--clickable:focus { outline: 2px solid var(--primary-color); outline-offset: -2px; }\n\n      .afc-time { display: inline-flex; gap: 6px; align-items: baseline; white-space: nowrap; }\n      .afc-time__orig { color: var(--primary-text-color); }\n      .afc-time__new { color: var(--warning-color, var(--primary-color)); font-weight: 600; }\n      .afc-time__arrow { color: var(--secondary-text-color); }\n\n      .afc-status { display: inline-block; font-weight: 600; }\n      .afc-status--ok { color: var(--primary-text-color); }\n      .afc-status--info { color: var(--secondary-text-color); }\n      .afc-status--warn { color: var(--warning-color, var(--primary-color)); }\n      .afc-status--bad { color: var(--error-color); }\n      .afc-status--good { color: var(--success-color); }\n\n      .afc-footer { margin-top: 8px; font-size: 0.8em; color: var(--secondary-text-color); }\n\n      .afc-details__back { display: inline-flex; align-items: center; margin: 0 0 10px 0; padding: 6px 10px; border: 1px solid var(--divider-color); border-radius: 6px; background: var(--card-background-color); color: var(--primary-text-color); cursor: pointer; }\n      .afc-details__title { font-weight: 600; margin-bottom: 8px; color: var(--primary-text-color); }\n      .afc-details__loading { color: var(--secondary-text-color); }\n      .afc-details__error { color: var(--error-color); white-space: pre-wrap; }\n\n      .afc-details__grid { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 8px; }\n      .afc-details__row { display: grid; grid-template-columns: minmax(110px, 0.9fr) 2fr; gap: 12px; align-items: baseline; padding: 8px 10px; border: 1px solid var(--divider-color); border-radius: 6px; }\n      .afc-details__label { color: var(--secondary-text-color); font-size: 0.85em; }\n      .afc-details__value { color: var(--primary-text-color); overflow-wrap: anywhere; }\n      .afc-details__route { font-weight: 600; }\n\n      .afc-details__raw { margin-top: 10px; }\n      .afc-details__raw > summary { cursor: pointer; color: var(--secondary-text-color); }\n      .afc-details__json { margin: 8px 0 0 0; padding: 10px; border: 1px solid var(--divider-color); border-radius: 6px; background: var(--card-background-color); color: var(--primary-text-color); overflow: auto; }\n    `;if(this._detailsFlightIata){const t=`Flight details: ${this._detailsFlightIata}`,e=this._detailsLoading?'<div class="afc-details__loading">Loading details from Airlabs…</div>':this._detailsError?`<div class="afc-details__error">${this._e(this._detailsError)}</div>`:this._renderFlightDetails(this._detailsData);this._content.innerHTML=`\n        <style>${y}</style>\n        ${m}\n        <div class="afc-details">\n          <button type="button" class="afc-details__back">Back</button>\n          <div class="afc-details__title">${this._e(t)}</div>\n          ${e}\n        </div>\n      `;const i=this._content.querySelector(".afc-details__back");return void(i&&(i.onclick=()=>{this._detailsFlightIata=null,this._detailsLoading=!1,this._detailsError="",this._detailsData=null,this.hass=this._hass}))}if(this._content.innerHTML=`\n      <style>${y}</style>\n      ${m}\n      <div class="afc-table-wrap">\n        <table class="afc-table">\n          ${f}\n          <tbody>\n            ${p}\n          </tbody>\n        </table>\n      </div>\n      <div class="afc-footer">\n        Flydata fra <a href="https://www.avinor.no/" target="_blank" rel="noreferrer">Avinor</a>\n      </div>\n    `,u){const t=this._content.querySelector("tbody");t&&(t.onclick=t=>{const i=this._getClickableRowFromEvent(t);if(i)if("more-info"!==g){if("flight-details"===g){const t=i.getAttribute("data-flight-iata")||"";if(!t)return;this._openFlightDetails(t)}}else this._fireMoreInfo(e)},t.onkeydown=t=>{const i=t.key;if("Enter"!==i&&" "!==i)return;const a=this._getClickableRowFromEvent(t);if(a)if(t.preventDefault(),"more-info"!==g){if("flight-details"===g){const t=a.getAttribute("data-flight-iata")||"";if(!t)return;this._openFlightDetails(t)}}else this._fireMoreInfo(e)})}}_getClickableRowFromEvent(t){try{const e=t&&"function"==typeof t.composedPath?t.composedPath():null;let i=(e&&e.length?e[0]:t?t.target:null)||null;if(i&&3===i.nodeType&&(i=i.parentElement),i&&"function"==typeof i.closest)return i.closest(".afc-row--clickable");if(i&&i.parentElement&&"function"==typeof i.parentElement.closest)return i.parentElement.closest(".afc-row--clickable")}catch(t){}return null}async _openFlightDetails(t){const e=String(t||"").trim();if(e){this._detailsFlightIata=e,this._detailsLoading=!0,this._detailsError="",this._detailsData=null,this.hass=this._hass;try{const t=await this._callFlightDetailsService(e);this._detailsData=t}catch(t){this._detailsError=t&&t.message?t.message:String(t)}finally{this._detailsLoading=!1,this.hass=this._hass}}}async _callFlightDetailsService(t){const e=this._hass;if(!e)throw new Error("Home Assistant not ready");const i={type:"call_service",domain:"avinor_flight_data",service:"get_flight_details",service_data:{flight_iata:String(t||"").trim()},return_response:!0};if("function"==typeof e.callWS){const t=await e.callWS(i);if(t&&"object"==typeof t){if(t.response&&"object"==typeof t.response)return t.response;if(t.result&&"object"==typeof t.result)return t.result}return t}if("function"==typeof e.callService)return e.callService("avinor_flight_data","get_flight_details",i.service_data),{note:"Service called. This Home Assistant version does not expose service responses to the frontend."};throw new Error("Home Assistant frontend does not support calling services")}_renderFlightDetails(t){const e=this._unwrapFlightDetails(t),i=()=>this._e(JSON.stringify(t||{},null,2)),a=t=>(Array.isArray(t)?t.filter(t=>null!=t).map(t=>String(t).trim()).filter(Boolean).map(t=>this._e(t)):[]).join("<br/>");if(!e||"object"!=typeof e)return`\n        <div class="afc-details__grid">\n          <div class="afc-details__row">\n            <div class="afc-details__label">Details</div>\n            <div class="afc-details__value">${this._e(String(e??"No data"))}</div>\n          </div>\n        </div>\n        <details class="afc-details__raw">\n          <summary>Raw data</summary>\n          <pre class="afc-details__json">${i()}</pre>\n        </details>\n      `;const r=this._getAny(e,["status","flight_status","flightStatus","flight_status_iata","flight_status_icao"]),n=this._getAny(e,["airline_name","airline","airline.name","airlineName","airline_fullname"]),o=this._getAny(e,["airline_iata","airline.iata","airlineIata"]),s=this._getAny(e,["airline_icao","airline.icao","airlineIcao"]),l=this._getAny(e,["callsign","call_sign","callSign"]),c=this._getAny(e,["flight_number","flightNumber","flight.number","flight.num"]),d=this._getAny(e,["flight_iata","flight.iata","iata"]),h=this._getAny(e,["flight_icao","flight.icao","icao"]),_=this._formatDetailsDateTime(this._getAny(e,["updated","updated_at","updatedAt","last_updated","timestamp"])),g=this._getAny(e,["dep_iata","departure.iata","dep.iata","dep_airport_iata","dep_airport"]),u=this._getAny(e,["dep_icao","departure.icao","dep.icao"]),p=this._getAny(e,["dep_name","departure.name","dep.name","departure.airport","dep_airport_name"]),f=this._getAny(e,["dep_city","departure.city","dep.city"]),m=this._getAny(e,["dep_terminal","departure.terminal","dep.terminal","departure.term"]),y=this._getAny(e,["dep_gate","departure.gate","dep.gate"]),v=this._getAny(e,["dep_baggage","departure.baggage","dep.baggage"]),b=this._getAny(e,["arr_iata","arrival.iata","arr.iata","arr_airport_iata","arr_airport"]),x=this._getAny(e,["arr_icao","arrival.icao","arr.icao"]),w=this._getAny(e,["arr_name","arrival.name","arr.name","arrival.airport","arr_airport_name"]),A=this._getAny(e,["arr_city","arrival.city","arr.city"]),k=this._getAny(e,["arr_terminal","arrival.terminal","arr.terminal","arrival.term"]),S=this._getAny(e,["arr_gate","arrival.gate","arr.gate"]),$=this._getAny(e,["arr_baggage","arrival.baggage","arr.baggage","baggage"]),D=this._getAny(e,["delayed","delay","delay_min","delayMinutes","dep_delay","arr_delay"]),C=this._formatDetailsDateTime(this._getAny(e,["dep_time","departure.scheduled","departure.scheduled_time","dep_scheduled","scheduled_departure"])),E=this._formatDetailsDateTime(this._getAny(e,["dep_estimated","dep_est","departure.estimated","departure.estimated_time","estimated_departure"])),L=this._formatDetailsDateTime(this._getAny(e,["dep_actual","dep_act","departure.actual","departure.actual_time","actual_departure"])),T=this._formatDetailsDateTime(this._getAny(e,["arr_time","arrival.scheduled","arrival.scheduled_time","arr_scheduled","scheduled_arrival"])),R=this._formatDetailsDateTime(this._getAny(e,["arr_estimated","arr_est","arrival.estimated","arrival.estimated_time","estimated_arrival"])),F=this._formatDetailsDateTime(this._getAny(e,["arr_actual","arr_act","arrival.actual","arrival.actual_time","actual_arrival"])),N=this._getAny(e,["aircraft_icao","aircraft.icao","aircraft.type","aircraftType"]),B=this._getAny(e,["aircraft_iata","aircraft.iata"]),I=this._getAny(e,["reg_number","registration","aircraft.reg","aircraft.registration","tail_number"]),M=this._getAny(e,["hex","aircraft_hex","aircraft.hex"]),j=this._getAny(e,["lat","latitude","live.lat","live.latitude"]),H=this._getAny(e,["lng","lon","longitude","live.lng","live.lon","live.longitude"]),O=this._getAny(e,["alt","altitude","live.alt","live.altitude"]),G=this._getAny(e,["speed","spd","live.speed"]),K=this._getAny(e,["dir","heading","track","live.dir","live.heading"]),P=g||u||"",q=b||x||"",z=P&&q?`${P} → ${q}`:"",U=[];if(z&&U.push(this._detailRow("Route",`<span class="afc-details__route">${this._e(z)}</span>`)),r){const t=this._getStatusKindFromText(r);U.push(this._detailRow("Status",`<span class="afc-status afc-status--${this._e(t)}">${this._e(r)}</span>`))}D&&U.push(this._detailRow("Delay",this._e(`${D} min`)));const W=[d,h,c].filter(Boolean).join(" · ");W&&U.push(this._detailRow("Flight",this._e(W)));const V=[n,[o,s].filter(Boolean).join(" / ")].filter(Boolean).join(" · ");V&&U.push(this._detailRow("Airline",this._e(V))),l&&U.push(this._detailRow("Callsign",this._e(l))),_&&U.push(this._detailRow("Updated",this._e(_)));const X=[[g,u].filter(Boolean).join(" · "),p,f].filter(Boolean).join(" — "),Z=[[b,x].filter(Boolean).join(" · "),w,A].filter(Boolean).join(" — ");X&&U.push(this._detailRow("Departure",this._e(X))),Z&&U.push(this._detailRow("Arrival",this._e(Z)));const Y=[m&&`Terminal: ${m}`,y&&`Gate: ${y}`,v&&`Baggage: ${v}`].filter(Boolean),J=[k&&`Terminal: ${k}`,S&&`Gate: ${S}`,$&&`Baggage: ${$}`].filter(Boolean);Y.length&&U.push(this._detailRow("Dep ops",a(Y))),J.length&&U.push(this._detailRow("Arr ops",a(J)));const Q=[C&&`Scheduled: ${C}`,E&&`Estimated: ${E}`,L&&`Actual: ${L}`].filter(Boolean),tt=[T&&`Scheduled: ${T}`,R&&`Estimated: ${R}`,F&&`Actual: ${F}`].filter(Boolean);Q.length&&U.push(this._detailRow("Dep times",a(Q))),tt.length&&U.push(this._detailRow("Arr times",a(tt)));const et=[N,B,I,M].filter(Boolean).join(" · ");et&&U.push(this._detailRow("Aircraft",this._e(et)));const it=[j&&H?`Position: ${j}, ${H}`:"",O?`Altitude: ${O}`:"",G?`Speed: ${G}`:"",K?`Heading: ${K}`:""].filter(Boolean);return it.length&&U.push(this._detailRow("Live",a(it))),U.length||U.push(this._detailRow("Details","No recognizable fields in response")),`\n      <div class="afc-details__grid">${U.join("")}</div>\n      <details class="afc-details__raw">\n        <summary>Raw data</summary>\n        <pre class="afc-details__json">${i()}</pre>\n      </details>\n    `}_detailRow(t,e){return`\n      <div class="afc-details__row">\n        <div class="afc-details__label">${this._e(t)}</div>\n        <div class="afc-details__value">${e}</div>\n      </div>\n    `}_unwrapFlightDetails(t){if(!t||"object"!=typeof t)return t;const e=["data","flight","flight_details","flightDetails","result","response"];for(const i of e)if(t[i]&&"object"==typeof t[i])return t[i];return t}_getAny(t,e){if(!t||"object"!=typeof t)return"";for(const i of e){const e=this._getPath(t,i);if(null==e)continue;if(String(e).trim())return e}return""}_getPath(t,e){if(!t||"object"!=typeof t)return;const i=String(e||"").split(".").map(t=>t.trim()).filter(Boolean);let a=t;for(const t of i){if(!a||"object"!=typeof a)return;a=a[t]}return a}_formatDetailsDateTime(t){if(null==t)return"";const e=String(t).trim();if(!e)return"";if("number"==typeof t||/^[0-9]{10,13}$/.test(e)){const e=Number(t);if(Number.isFinite(e)){const t=new Date(e>1e12?e:1e3*e);if(!isNaN(t.getTime()))return this._formatDateTimeLocal(t)}}const i=this._tryParseDate(e);return i?this._formatDateTimeLocal(i):e}_formatDateTimeLocal(t){try{return new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(t)}catch(e){return t.toLocaleString()}}_getStatusKindFromText(t){const e=String(t||"").toLowerCase();return e?e.includes("cancel")?"bad":e.includes("delay")||e.includes("divert")||e.includes("late")||e.includes("hold")?"warn":e.includes("arriv")||e.includes("land")||e.includes("depart")||e.includes("airborne")||e.includes("en route")||e.includes("en-route")||e.includes("active")?"good":(e.includes("scheduled")||e.includes("boarding")||e.includes("gate"),"ok"):"info"}_e(t){if(null==t)return"";return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}_applySortAndLimit(t){const e=Array.isArray(t)?t.slice():[],i=String(this._config&&this._config.sort_by?this._config.sort_by:"scheduled").trim().toLowerCase(),a="desc"===String(this._config&&this._config.sort_dir?this._config.sort_dir:"asc").trim().toLowerCase()?-1:1,r=t=>{if(!t)return"";switch(i){case"flight":return t.flightId||"";case"type":return t.dom_int||"";case"airport":return this._getAirportName(t.airport||"");case"check_in":return t.check_in||"";case"gate":return t.gate||"";case"status":return t.status_code||"";default:{const e=t.new_time||t.estimated_time||t.expected_time||t.actual_time||t.time||t.schedule_time,i=this._tryParseDate(e);return i?i.getTime():this._extractTime(e)||""}}},n=e.map((t,e)=>({f:t,idx:e}));n.sort((t,e)=>{const i=r(t.f),n=r(e.f);if("number"==typeof i&&"number"==typeof n&&isFinite(i)&&isFinite(n))return i<n?-1*a:i>n?1*a:t.idx-e.idx;const o=String(i).toLowerCase(),s=String(n).toLowerCase();return o<s?-1*a:o>s?1*a:t.idx-e.idx});let o=n.map(t=>t.f);const s=this._config&&void 0!==this._config.max_rows?this._config.max_rows:0,l=Number.isFinite(Number(s))?Math.max(0,Math.floor(Number(s))):0;return l>0&&(o=o.slice(0,l)),o}_normalizeExcludedColumns(t){const e=new Set,i=Array.isArray(t)?t:"string"==typeof t?t.split(","):[];for(const t of i){if(null==t)continue;const i=String(t).trim().toLowerCase().replace(/\s+/g,"_").replace(/-/g,"_");i&&e.add(i)}return e}_getAirportName(t){if(!t)return"";return{OSL:"Oslo",BGO:"Bergen",TRD:"Trondheim",SVG:"Stavanger",BOO:"Bodø",TOS:"Tromsø",AES:"Ålesund",KRS:"Kristiansand",HAU:"Haugesund",MOL:"Molde",EVE:"Harstad/Narvik",KKN:"Kirkenes",LKL:"Lakselv",ALF:"Alta",HFT:"Hammerfest",VDS:"Vadsø",BDU:"Bardufoss",SSJ:"Sandnessjøen",MJF:"Mosjøen",RVK:"Rørvik",BNN:"Brønnøysund",SKN:"Stokmarknes",LYR:"Longyearbyen",ANX:"Andøya",FDE:"Førde",SOG:"Sogndal",FRO:"Florø",NTB:"Notodden",SKE:"Skien",TRF:"Sandefjord",RRS:"Røros",OLA:"Ørland",HOV:"Ørsta-Volda",SDN:"Sandane",CPH:"Copenhagen",ARN:"Stockholm",HEL:"Helsinki",LHR:"London",AMS:"Amsterdam",CDG:"Paris",FRA:"Frankfurt",MUC:"Munich",ZRH:"Zurich",BCN:"Barcelona",MAD:"Madrid",FCO:"Rome",IST:"Istanbul",DXB:"Dubai",DOH:"Doha",JFK:"New York",EWR:"Newark",ORD:"Chicago",LAX:"Los Angeles",MIA:"Miami",BKK:"Bangkok",SIN:"Singapore",HKG:"Hong Kong",NRT:"Tokyo",ICN:"Seoul",KEF:"Reykjavik",ATH:"Athens",DUB:"Dublin",BRU:"Brussels",VIE:"Vienna",PRG:"Prague",WAW:"Warsaw",LIS:"Lisbon",MAN:"Manchester",EDI:"Edinburgh",GLA:"Glasgow",NCE:"Nice",LYS:"Lyon",TXL:"Berlin",HAM:"Hamburg",DUS:"Düsseldorf",BER:"Berlin",CGN:"Cologne",STR:"Stuttgart"}[t]||t}_getStatusText(t){if(!t)return"";return{E:"New Info",A:"Arrived",C:"Cancelled",D:"Departed",N:"New Time",BRD:"Boarding",GCL:"Gate Closed",GTD:"Gate Open",DLY:"Delayed",EXP:"Expected",FIR:"Final Call",WIL:"Wait in Lounge",DEP:"Departed",ARR:"Arrived",CNX:"Cancelled",AIR:"Airborne",LND:"Landed",CKI:"Check-in",CKC:"Check-in Closed"}[t]||t}_extractTime(t){if(!t)return"";try{const e=new Date(t+(t.includes("Z")?"":"Z"));if(isNaN(e.getTime()))return t;const i=e.getHours().toString().padStart(2,"0");return`${i}:${e.getMinutes().toString().padStart(2,"0")}`}catch(e){return t}}_formatUpdated(t){if(!t)return"";const e=this._tryParseDate(t);if(!e)return String(t);const i=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"}).format(e),a=this._formatRelativeTime(e);return a?`${i} (${a})`:i}_tryParseDate(t){if(!t)return null;if(t instanceof Date)return isNaN(t.getTime())?null:t;const e=String(t).trim();if(!e)return null;const i=new Date(e);if(!isNaN(i.getTime()))return i;const a=new Date(e+(e.includes("Z")?"":"Z"));return isNaN(a.getTime())?null:a}_formatRelativeTime(t){const e=Date.now()-t.getTime();if(!isFinite(e))return"";const i=Math.round(e/1e3);if(i<0)return"";if(i<60)return`${i}s ago`;const a=Math.round(i/60);if(a<60)return`${a}m ago`;const r=Math.round(a/60);if(r<24)return`${r}h ago`;return`${Math.round(r/24)}d ago`}_formatScheduleCell(t){const e=this._extractTime(t.schedule_time),i=t.new_time||t.estimated_time||t.expected_time||t.actual_time||t.time,a=i?this._extractTime(i):"";return a&&a!==e?`<span class="afc-time"><span class="afc-time__orig">${this._e(e)}</span><span class="afc-time__arrow">→</span><span class="afc-time__new">${this._e(a)}</span></span>`:`<span class="afc-time"><span class="afc-time__orig">${this._e(e)}</span></span>`}_getStatusKind(t){const e=String(t||"").toUpperCase();return e?"C"===e||"CNX"===e?"bad":"DLY"===e||"N"===e||"E"===e?"warn":"A"===e||"ARR"===e||"LND"===e||"D"===e||"DEP"===e?"good":"BRD"===e||"GTD"===e||"FIR"===e?"warn":"ok":"info"}_fireMoreInfo(t){const e=new CustomEvent("hass-more-info",{bubbles:!0,composed:!0,detail:{entityId:t}});this.dispatchEvent(e)}getCardSize(){return 4}}customElements.define("avinor-flight-card",t);class e extends HTMLElement{constructor(){super(),this._config=null,this._hass=null}setConfig(t){this._config={title:"",exclude_columns:[],compact:!1,show_table_header:!0,show_meta:!0,row_click_action:"none",sort_by:"scheduled",sort_dir:"asc",max_rows:0,...t},this.render()}configChanged(t){const e=new Event("config-changed",{bubbles:!0,composed:!0});e.detail={config:t},this.dispatchEvent(e)}render(){if(!this._config)return;const t=(this._hass?Object.keys(this._hass.states).filter(t=>t.startsWith("sensor.avinor_")).sort():[]).map(t=>{const e=this._hass.states[t];return`<option value="${t}">${t} - ${e.attributes.airport||""} ${"D"===(e.attributes.direction||"")?"Departures":"Arrivals"}</option>`}).join(""),e=new Set(Array.isArray(this._config.exclude_columns)?this._config.exclude_columns.map(t=>String(t).toLowerCase().replace(/\s+/g,"_").replace(/-/g,"_")):[]),i=[{key:"flight",label:"Flight"},{key:"type",label:"Type"},{key:"scheduled",label:"Scheduled"},{key:"airport",label:"Airport"},{key:"check_in",label:"Check-in"},{key:"gate",label:"Gate"},{key:"status",label:"Status"}].map(({key:t,label:i})=>`\n      <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n        <input type="checkbox" data-col="${t}" ${e.has(t)?"checked":""} />\n        <span>${i}</span>\n      </label>\n    `).join(""),a=this._config.row_click_action||"none",r=this._config.sort_by||"scheduled",n=this._config.sort_dir||"asc",o=void 0===this._config.max_rows||null===this._config.max_rows?0:this._config.max_rows;this.innerHTML=`\n      <div style="padding: 16px;">\n        <div style="margin-bottom: 16px; position: relative;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Entity (required)\n          </label>\n          <select\n            id="entity"\n            style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n          >\n            <option value="">-- Select an entity --</option>\n            ${t}\n          </select>\n          <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">\n            Select an Avinor flight sensor entity\n          </div>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Title (optional)\n          </label>\n          <input\n            type="text"\n            id="title"\n            value="${this._config.title||""}"\n            placeholder="Avganger OSL"\n            style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n          />\n          <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">\n            Card title (leave empty for default)\n          </div>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Exclude columns (optional)\n          </label>\n          <div style="padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px;">\n            ${i}\n          </div>\n          <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">\n            Check the columns you want to hide\n          </div>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Layout (optional)\n          </label>\n          <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n            <input type="checkbox" id="compact" ${this._config.compact?"checked":""} />\n            <span>Compact rows</span>\n          </label>\n          <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n            <input type="checkbox" id="show_table_header" ${this._config.show_table_header?"checked":""} />\n            <span>Show table header</span>\n          </label>\n          <label style="display:flex; align-items:center; gap:8px; margin: 6px 0;">\n            <input type="checkbox" id="show_meta" ${this._config.show_meta?"checked":""} />\n            <span>Show meta line (airport/direction/updated)</span>\n          </label>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Row click action (optional)\n          </label>\n          <select\n            id="row_click_action"\n            style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n          >\n            <option value="none" ${"none"===a?"selected":""}>None</option>\n            <option value="more-info" ${"more-info"===a?"selected":""}>Open entity more-info</option>\n            <option value="flight-details" ${"flight-details"===a?"selected":""}>Open flight details (Airlabs)</option>\n          </select>\n        </div>\n\n        <div style="margin-bottom: 16px;">\n          <label style="display: block; margin-bottom: 8px; font-weight: 500;">\n            Sorting & limiting (optional)\n          </label>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">\n            <div>\n              <div style="margin-bottom: 6px; color: var(--secondary-text-color);">Sort by</div>\n              <select\n                id="sort_by"\n                style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n              >\n                <option value="scheduled" ${"scheduled"===r?"selected":""}>Scheduled</option>\n                <option value="flight" ${"flight"===r?"selected":""}>Flight</option>\n                <option value="type" ${"type"===r?"selected":""}>Type</option>\n                <option value="airport" ${"airport"===r?"selected":""}>Airport</option>\n                <option value="check_in" ${"check_in"===r?"selected":""}>Check-in</option>\n                <option value="gate" ${"gate"===r?"selected":""}>Gate</option>\n                <option value="status" ${"status"===r?"selected":""}>Status</option>\n              </select>\n            </div>\n            <div>\n              <div style="margin-bottom: 6px; color: var(--secondary-text-color);">Direction</div>\n              <select\n                id="sort_dir"\n                style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n              >\n                <option value="asc" ${"asc"===n?"selected":""}>Ascending</option>\n                <option value="desc" ${"desc"===n?"selected":""}>Descending</option>\n              </select>\n            </div>\n          </div>\n          <div style="margin-top: 12px;">\n            <div style="margin-bottom: 6px; color: var(--secondary-text-color);">Max rows</div>\n            <input\n              type="number"\n              id="max_rows"\n              min="0"\n              step="1"\n              value="${o}"\n              placeholder="0"\n              style="width: 100%; padding: 8px; border: 1px solid var(--divider-color); border-radius: 4px; background: var(--card-background-color); color: var(--primary-text-color);"\n            />\n            <div style="margin-top: 4px; font-size: 0.9em; color: var(--secondary-text-color);">0 = show all flights</div>\n          </div>\n        </div>\n      </div>\n    `;const s=this.querySelector("#entity");this._config.entity&&(s.value=this._config.entity),s.addEventListener("change",t=>{this._config={...this._config,entity:t.target.value},this.configChanged(this._config)}),this.querySelector("#title").addEventListener("input",t=>{this._config={...this._config,title:t.target.value},this.configChanged(this._config)}),this.querySelectorAll('input[type="checkbox"][data-col]').forEach(t=>{t.addEventListener("change",()=>{const t=[];this.querySelectorAll('input[type="checkbox"][data-col]').forEach(e=>{e.checked&&t.push(e.getAttribute("data-col"))}),this._config={...this._config,exclude_columns:t},this.configChanged(this._config)})});const l=this.querySelector("#compact");l&&l.addEventListener("change",t=>{this._config={...this._config,compact:!!t.target.checked},this.configChanged(this._config)});const c=this.querySelector("#show_table_header");c&&c.addEventListener("change",t=>{this._config={...this._config,show_table_header:!!t.target.checked},this.configChanged(this._config)});const d=this.querySelector("#show_meta");d&&d.addEventListener("change",t=>{this._config={...this._config,show_meta:!!t.target.checked},this.configChanged(this._config)});const h=this.querySelector("#row_click_action");h&&h.addEventListener("change",t=>{this._config={...this._config,row_click_action:t.target.value},this.configChanged(this._config)});const _=this.querySelector("#sort_by");_&&_.addEventListener("change",t=>{this._config={...this._config,sort_by:t.target.value},this.configChanged(this._config)});const g=this.querySelector("#sort_dir");g&&g.addEventListener("change",t=>{this._config={...this._config,sort_dir:t.target.value},this.configChanged(this._config)});const u=this.querySelector("#max_rows");u&&u.addEventListener("input",t=>{const e=t.target.value,i=""===e?0:Number(e);this._config={...this._config,max_rows:Number.isFinite(i)?Math.max(0,Math.floor(i)):0},this.configChanged(this._config)})}set hass(t){this._hass=t,this._config&&this.render()}}customElements.define("avinor-flight-card-editor",e),console.info("%c AVINOR-FLIGHT-CARD %c Registered successfully with visual editor ","background-color: #41bdf5; color: #fff; font-weight: bold;","background-color: #333; color: #fff;");
